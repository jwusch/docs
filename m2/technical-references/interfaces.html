
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Interfaces Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="communication.html" />
    
    
    <link rel="prev" href="processor.html" />
    

    </head>
    <body>
        
<header class="main-header">
    <h1 class="main-header__title"><a href="https://macchina.cc" class="main-header__link"><img src="/images/logo.svg" alt="Macchina logo" class="main-header__logo"></a> Docs</h1>
</header>

<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="../">
            
                <a href="../">
            
                    
                    M2 Docs
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1.1" data-path="../getting-started/">
            
                <a href="../getting-started/">
            
                    
                    Getting Started
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1.1.1" data-path="../getting-started/arduino.html">
            
                <a href="../getting-started/arduino.html">
            
                    
                    Arduino IDE
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.1.1.2" data-path="../build-something/">
            
                <a href="../build-something/">
            
                    
                    Build Something
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1.2.1" data-path="../build-something/car-hacking/">
            
                <a href="../build-something/car-hacking/">
            
                    
                    Car Hacking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.2.2" data-path="../build-something/projects/">
            
                <a href="../build-something/projects/">
            
                    
                    Projects
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1.2.2.1" data-path="../build-something/projects/quick.html">
            
                <a href="../build-something/projects/quick.html">
            
                    
                    Quick
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.2.2.2" data-path="../build-something/projects/involved.html">
            
                <a href="../build-something/projects/involved.html">
            
                    
                    Involved
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.1.1.3" data-path="./">
            
                <a href="./">
            
                    
                    Technical References
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1.3.1" data-path="installation.html">
            
                <a href="installation.html">
            
                    
                    Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.3.2" data-path="processor.html">
            
                <a href="processor.html">
            
                    
                    Processor
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.1.1.3.3" data-path="interfaces.html">
            
                <a href="interfaces.html">
            
                    
                    Interfaces
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.3.4" data-path="communication.html">
            
                <a href="communication.html">
            
                    
                    Communication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.3.5" data-path="power.html">
            
                <a href="power.html">
            
                    
                    Power
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.3.6" data-path="memory.html">
            
                <a href="memory.html">
            
                    
                    Memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.3.7" data-path="12VIO.md">
            
                <span>
            
                    
                    12V IO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.3.8" data-path="leds-buttons.html">
            
                <a href="leds-buttons.html">
            
                    
                    LEDS/Buttons
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.3.9" data-path="mechanical.html">
            
                <a href="mechanical.html">
            
                    
                    Mechanical
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.3.10" data-path="byob.html">
            
                <a href="byob.html">
            
                    
                    BYOB
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                

                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Interfaces</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="automotive-interfaces">Automotive Interfaces</h1>
<p><a href="#can">CAN</a></p>
<p><a href="#single-wire-can">Single-wire CAN</a></p>
<p><a href="#lin">LIN</a></p>
<p><a href="#k-line">K-line</a></p>
<p><a href="#j1850">J1850 PWM/VPW</a></p>
<hr>
<p>The lower board of M2 contains both the power supply circuitry and the automotive interfaces required to communicate with your car. This includes:</p>
<ul>
<li>2x CAN bus</li>
<li>1x SWCAN (single wire can)</li>
<li>2x LIN/9141</li>
<li>J1805 VPW/PWM</li>
</ul>
<p><img src="../../images/Interface_0d024.png" width="640"></p>
<p>In addition, every M2 has a 26 pin &quot;expansion&quot; connector that provides even more connection options. For example: UART, SPI, I2C, general purpose 12V drivers and 12V analog inputs. See the schematic for actual pinout details:</p>
<p><a href="https://github.com/macchina/m2-hardware" target="_blank">https://github.com/macchina/m2-hardware</a></p>
<p>Refer to the following diagram for pin 1 location.</p>
<p><img src="../../images/26pin_connector.png" width="640"></p>
<hr>
<h2 id="can">CAN</h2>
<p><a href="https://en.wikipedia.org/wiki/CAN_bus" target="_blank">Controller Area Network</a></p>
<p>CAN bus is a vehicle bus standard used in most cars built after 2006. It is a message-based protocol that allows modules within a car to communicate with one another. While the physical layer is understood and open, the actual meaning of the messages sent over the bus are not. While some messages are legislated to be &quot;standard&quot;, the majority of CAN messages in your typical car are not well documented.</p>
<p>M2 has 2 CAN channels (In addition to a <a href="http://docs.macchina.cc/m2/automotive-interfaces/single-wire-can.html" target="_blank">Single-wire CAN</a> channel) that can interface directly to the CAN bus network of your car. M2 uses the 2 built-in CAN controllers found in the SAM3X and 2 external TJA1051 transceivers.</p>
<p>Here is the link to the datasheet: <a href="http://www.nxp.com/docs/en/data-sheet/TJA1051.pdf" target="_blank">http://www.nxp.com/docs/en/data-sheet/TJA1051.pdf</a></p>
<p>CAN bus connections can be found on either the 16 pin OBD2 connector on the <a href="http://docs.macchina.cc/m2/overview/utd-under-dash.html" target="_blank">UTD M2</a> or the 24 pin connector used on the <a href="http://docs.macchina.cc/m2/overview/uth-under-hood.html" target="_blank">UTH M2</a>.</p>
<p>Arduino libraries are well developed and available here:</p>
<p><a href="https://github.com/collin80/due_can" target="_blank">https://github.com/collin80/due_can</a></p>
<p>[TO DO: Discuss termination and how to terminate with solder jumpers on interface board.]</p>
<p>[TO DO: Add schematic page for CAN bus transceivers]</p>
<hr>
<h2 id="single-wire-can">Single-wire CAN</h2>
<p>Here is where we talk about all the SW can libraries.</p>
<hr>
<h2 id="lin">LIN</h2>
<p><a href="https://en.wikipedia.org/wiki/Local_Interconnect_Network" target="_blank">Local Interconnect Network</a></p>
<p>LIN bus is an inexpensive, single wire, serial network protocol used in many modern cars. Typically, LIN would be used to control and monitor lower-priority devices such as seat positions, door locks, radio and illumination.</p>
<p>M2 has 2 LIN channels that can interface directly to the LIN bus network of your car. M2 uses 2 external TJA1021 transceivers connected via UART to the processor.</p>
<p>Here is the link to the datasheet: <a href="http://www.nxp.com/docs/en/data-sheet/TJA1021.pdf" target="_blank">http://www.nxp.com/docs/en/data-sheet/TJA1021.pdf</a></p>
<p>Note that the TJA1021 transceiver is used for both LIN and ISO9141 (K-LINE/L-LINE) for a a total of 2 channels.</p>
<p>LIN bus connections can be found on either the 16 pin OBD2 connector on the <a href="http://docs.macchina.cc/m2/overview/utd-under-dash.html" target="_blank">UTD M2</a> or the 24 pin connector used on the <a href="http://docs.macchina.cc/m2/overview/uth-under-hood.html" target="_blank">UTH M2</a>.</p>
<p><img src="../../images/LIN_Logo_0114b.jpg" width="220"></p>
<p>Arduino libraries are available here: <a href="https://github.com/macchina/LIN" target="_blank">https://github.com/macchina/LIN</a></p>
<hr>
<h2 id="k-line">K-line</h2>
<p>ISO9141 (K-Line) interface uses the TJA1021. While this part is designed for LIN, it is also K-line compatible.</p>
<p>Here is the link to the datasheet: <a href="http://www.nxp.com/docs/en/data-sheet/TJA1021.pdf" target="_blank">http://www.nxp.com/docs/en/data-sheet/TJA1021.pdf</a></p>
<h2 id="j1850">J1850</h2>
<p>Here we will describe more about how the J1850 circuitry works. To begin with, to change between the levels required for PWM and VPW variants of J1850, use this signal:</p>
<p><code>J1850_PWM_nVPW</code></p>
<p>This signal is connected to Pin 123 (PB8) of the SAM3X.</p>
<p>Make this pin HIGH for PWM and LOW for VPW</p>
<p>This is an example of some code that will both turn on power to J1850 circuit AND set level for either PWM or VPW:</p>
<pre><code class="lang-CPP"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
  pinMode(PS_J1850_9141, OUTPUT);
  pinMode(PWM_nVPW, OUTPUT);

  digitalWrite(PS_J1850_9141, HIGH);  <span class="hljs-comment">// LOW  = no power at +12V_SW/+5V_SW</span>
                                      <span class="hljs-comment">// HIGH = power at +12V_SW/+5V_SW</span>

  digitalWrite(PWM_nVPW, HIGH);       <span class="hljs-comment">// LOW  = ~7.9v (VPW)</span>
                                      <span class="hljs-comment">// HIGH = ~5.9V (PWM)</span>
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{
}
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
<footer>
    Can't find what your are looking for?  <a href="https://github.com/macchina/docs/issue">Open an Issue on GitHub</a> or <a href="https://forum.macchina.cc/">ask on the Forum</a>.
    <br/><br/>
    This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
    All code samples in this work are released to the public domain using the <a href="http://creativecommons.org/publicdomain/zero/1.0/">Creative Commons CC0 Public Domain Dedication</a>.
</footer>

            </div>

            
                
                <a href="processor.html" class="navigation navigation-prev " aria-label="Previous page: Processor">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="communication.html" class="navigation navigation-next " aria-label="Next page: Communication">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Interfaces","level":"1.1.1.3.3","depth":4,"next":{"title":"Communication","level":"1.1.1.3.4","depth":4,"path":"m2/technical-references/communication.md","ref":"m2/technical-references/communication.md","articles":[]},"previous":{"title":"Processor","level":"1.1.1.3.2","depth":4,"path":"m2/technical-references/processor.md","ref":"m2/technical-references/processor.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["ga","custom-favicon","edit-link"],"pluginsConfig":{"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"favicon":"images/favicon.ico","custom-favicon":{},"ga":{"configuration":"auto","token":"UA-75126303-1"},"sharing":{"facebook":false,"twitter":false,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"Edit This Page","base":"https://github.com/macchina/docs/edit/master/"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"index.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"./styles/website.css"}},"file":{"path":"m2/technical-references/interfaces.md","mtime":"2017-09-24T00:23:40.361Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-09-24T00:24:39.958Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>


        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

